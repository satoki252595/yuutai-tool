# 包括的スクレイピング解決策

## 問題の根本原因
- 現在のデータベース: 860件の銘柄のみ
- 実際の上場企業: 約3,800社
- **78%の銘柄が未登録**

## 改善策

### 1. 包括的スクレイピングシステムの構築
- **全証券コード範囲**（1300-9999）を網羅
- **エラー耐性強化**（最大3回リトライ）
- **進捗管理**（中断・再開機能）
- **複数データソース対応**

### 2. 推奨実行手順

```bash
# 1. 現在のサーバーを停止
# Ctrl+C で停止

# 2. 包括的スクレイピングを実行（推奨）
cd /Users/satoki252595/work/0000_kabulab/0016_yuutai/backend
node comprehensive-scraper.js

# 3. 進捗確認（別ターミナル）
tail -f scraping-errors.log
cat scraping-progress.json

# 4. 完了後サーバー再起動
cd ..
npm run server
```

### 3. スクレイピング仕様
- **対象**: 全証券コード（約6,700件）
- **処理順**: 優待密度の高い範囲から優先
- **速度**: 2秒間隔（サーバー負荷を考慮）
- **推定時間**: 約4-5時間
- **結果**: 1,500-2,000件の優待銘柄を期待

### 4. 安全機能
- **進捗保存**: 10件ごとに自動保存
- **中断再開**: いつでも中断・再開可能
- **エラーログ**: 全エラーを記録
- **リトライ機能**: 一時的エラーを自動回復

### 5. 期待される結果
- **総銘柄数**: 860件 → 2,500-3,000件
- **優待銘柄**: 860件 → 1,500-2,000件
- **検索精度**: 大幅向上（有名銘柄100%カバー）
- **「その他」分類**: 5.4%を維持

## 実行判断
- **時間**: 4-5時間の処理時間が必要
- **メリット**: 完全なデータベースが構築される
- **リスク**: 低い（進捗保存により中断・再開可能）